@version: 3.25
@include "scl.conf"

--- Source: Listen for Syslog traffic on UDP 514 ---

source s_net {
network(
ip(0.0.0.0)
port(514)
transport("udp")
);
};

--- Destination: Forward logs to Loki via HTTP ---

destination d_loki {
# URL points to the Loki service inside the Docker network
http(
url("http://loki:3100/loki/api/v1/push")
headers("Content-Type: application/json")
# Loki requires a specific JSON format for its push API (streams and values)
template("{"streams":[{"stream":{"job":"network_logs","source_app":"syslog-ng","host":"$HOST\"},\"values\":[[\"${ISODATE}","${MSG}"]]}]}")
);
};

--- Log Path: Connect the source (s_net) to the destination (d_loki) ---

log {
source(s_net);
destination(d_loki);
};